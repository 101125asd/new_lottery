# 手机端连接问题诊断和修复

## 当前状态检查

✅ **前端服务器正在运行**（端口 5173，监听在 0.0.0.0）  
✅ **后端服务器正在运行**（端口 8000，监听在 0.0.0.0）

## 检测到的 IP 地址

您的电脑有多个 IP 地址：
- `192.168.205.1` （可能是虚拟网络适配器）
- `192.168.8.1` （可能是路由器/热点）
- `10.106.73.189` （可能是公司网络）

## 解决方案

### 步骤 1：确定正确的 IP 地址

**方法 A：查看 WiFi 网络信息**
1. 打开 Windows 设置 → 网络和 Internet → WiFi
2. 点击您连接的 WiFi 网络
3. 查看 "IPv4 地址"，这应该是手机需要连接的 IP

**方法 B：使用命令查看**
```powershell
# 查看所有网络适配器的详细信息
ipconfig /all
```
找到 "无线局域网适配器 WLAN" 或 "以太网适配器" 下的 IPv4 地址。

### 步骤 2：在手机浏览器中测试

使用以下地址（替换为您的实际 IP）：

**选项 1：** `http://192.168.205.1:5173/mobile`  
**选项 2：** `http://192.168.8.1:5173/mobile`  
**选项 3：** `http://10.106.73.189:5173/mobile`

### 步骤 3：检查防火墙

如果手机无法连接，可能是防火墙阻止了端口：

**快速修复（临时开放端口）：**
```powershell
# 以管理员身份运行 PowerShell，然后执行：
netsh advfirewall firewall add rule name="Vite Dev Server" dir=in action=allow protocol=TCP localport=5173
netsh advfirewall firewall add rule name="FastAPI Backend" dir=in action=allow protocol=TCP localport=8000
```

或者运行已创建的脚本：
```powershell
powershell -ExecutionPolicy Bypass -File add_firewall_rules.ps1
```

### 步骤 4：验证网络连接

**在手机浏览器中测试：**

1. **测试前端页面：**
   - 访问：`http://[您的IP]:5173/`
   - 应该能看到大屏页面

2. **测试后端 API：**
   - 访问：`http://[您的IP]:8000/api/get-ip`
   - 应该返回 JSON 数据：`{"ip": "..."}`

3. **测试手机端页面：**
   - 访问：`http://[您的IP]:5173/mobile`
   - 应该能看到登录页面

### 步骤 5：检查手机和电脑是否在同一网络

**重要：** 手机和电脑必须连接到**同一个 WiFi 网络**。

**检查方法：**
1. 在手机上查看 WiFi 设置，确认连接的 WiFi 名称
2. 在电脑上查看 WiFi 设置，确认连接的 WiFi 名称
3. 两者必须相同！

**如果手机使用移动数据：**
- 手机无法通过局域网 IP 访问电脑
- 需要将手机连接到与电脑相同的 WiFi

## 常见错误和解决方案

### 错误 1：无法打开页面 / 连接超时

**可能原因：**
- 防火墙阻止了端口
- IP 地址不正确
- 手机和电脑不在同一网络

**解决方案：**
1. 检查防火墙设置（见步骤 3）
2. 确认 IP 地址（见步骤 1）
3. 确认手机和电脑在同一 WiFi

### 错误 2：页面加载但显示空白

**可能原因：**
- JavaScript 错误
- 资源加载失败

**解决方案：**
1. 打开手机浏览器的开发者工具（如果支持）
2. 查看控制台错误信息
3. 检查网络请求是否成功

### 错误 3：WebSocket 连接失败

**可能原因：**
- 后端服务未运行
- 防火墙阻止了 WebSocket 连接
- IP 地址配置错误

**解决方案：**
1. 确认后端服务正在运行（端口 8000）
2. 检查防火墙规则
3. 查看 `frontend/src/utils/api.js` 中的 WebSocket URL 配置

## 快速测试脚本

创建一个测试页面来验证连接：

在手机浏览器访问：`http://[您的IP]:5173/mobile`

如果能看到登录页面，说明前端连接正常。  
如果能看到 "已连接，等待大奖降临..."，说明 WebSocket 连接正常。

## 需要帮助？

如果以上步骤都无法解决问题，请提供：
1. 手机浏览器的错误信息（截图或文字）
2. 手机和电脑的 IP 地址
3. 手机和电脑连接的 WiFi 名称

